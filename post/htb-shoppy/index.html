<!DOCTYPE html>
<html lang="en">
  <head>
    
      <title>
        ðŸ‡«ðŸ‡· HackTheBox - Shoppy ::
        infosec blog
      </title>
    
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta
  name="description"
  content="shoppy.htb # Difficulty: Easy OS: Linux Link: https://app.hackthebox.com/machines/Shoppy Note # Il s&amp;rsquo;agit d&amp;rsquo;un des premiers write-ups que j&amp;rsquo;ai Ã©crit de ma vie, j&amp;rsquo;ai attendu que la machine retire avant de le poster. C&amp;rsquo;est aussi possible que je n&amp;rsquo;utilise pas les bons termes Ã  certains endroit, je n&amp;rsquo;ai pas relu tout le write-up pour me corriger (j&amp;rsquo;ai bien trop la flemme).
Vous allez aussi pouvoir voir Ã  quoi ressemblait mon mAgniFiQuE Ubuntu Ã  cette Ã©poque (pas si lointaine)"
/>
<meta
  name="keywords"
  content="rami malek"
/>
<meta name="robots" content="noodp" />
<link rel="canonical" href="/post/htb-shoppy/" />


<meta name="description" content="un blog sur lequel vous pourrez retrouver des writeups et des posts explicatifs en franÃ§ais et en anglais">




<link rel="stylesheet" href="/css/style.css" />

<link rel="stylesheet" href="/style.css" />


<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/img/apple-touch-icon-144-precomposed.png" />
<link rel="shortcut icon" href="/img/favicon.png" />


<link href="/fonts/Inter-Italic.woff2" rel="preload" type="font/woff2" as="font" crossorigin="">
<link href="/fonts/Inter-Regular.woff2" rel="preload" type="font/woff2" as="font" crossorigin="">
<link href="/fonts/Inter-Medium.woff2" rel="preload" type="font/woff2" as="font" crossorigin="">
<link href="/fonts/Inter-MediumItalic.woff2" rel="preload" type="font/woff2" as="font" crossorigin="">
<link href="/fonts/Inter-Bold.woff2" rel="preload" type="font/woff2" as="font" crossorigin="">
<link href="/fonts/Inter-BoldItalic.woff2" rel="preload" type="font/woff2" as="font" crossorigin="">


<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="ðŸ‡«ðŸ‡· HackTheBox - Shoppy"/>
<meta name="twitter:description" content="Mon premier write-up sur HTB, pour la room &#34;Shoppy&#34;"/>



<meta property="og:title" content="ðŸ‡«ðŸ‡· HackTheBox - Shoppy" />
<meta property="og:description" content="Mon premier write-up sur HTB, pour la room &#34;Shoppy&#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/post/htb-shoppy/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2023-01-14T00:00:00+00:00" />
<meta property="article:modified_time" content="2023-01-14T00:00:00+00:00" /><meta property="og:site_name" content="infosec blog" />







  </head>
  <body class="dark-theme">
    <div class="container">
      <header class="header">
  <span class="header__inner">
    <a
  href="/"
  class="logo"
  style="text-decoration: none;"
>
  
    <span class="logo__mark"><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44">
  <path fill="none" d="M15 8l14.729 14.382L15 35.367" />
</svg>
</span>
    <span class="logo__text"
      >c0nfl1c7</span
    >
    <span class="logo__cursor"></span>
  
</a>

    <span class="header__right">
      
        <nav class="menu">
  <ul class="menu__inner menu__inner--desktop">
    
      
        
          <li><a href="/about">About</a></li>
        
      
        
          <li><a href="/archive">Archive</a></li>
        
      
      
      
  </ul>

  <ul class="menu__inner menu__inner--mobile">
    
      
        <li><a href="/about">About</a></li>
      
    
      
        <li><a href="/archive">Archive</a></li>
      
    
  </ul>
</nav>

        <span class="menu-trigger">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M0 0h24v24H0z" fill="none" />
            <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z" />
          </svg>
        </span>
      
      <span class="theme-toggle">
        <svg
  class="theme-toggler"
  width="24"
  height="24"
  viewBox="0 0 48 48"
  fill="none"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
  3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
  13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"
  />
</svg>

      </span>
    </span>
  </span>
</header>


      <div class="content">
        
  
  

  <article class="post">
    <h1 class="post-title">ðŸ‡«ðŸ‡· HackTheBox - Shoppy</h1>
    <div class="post-meta">
      
        <time class="post-date">
          14-01-2023
        </time>

        
          
        
      

      
        <span class="post-author"
          >â€” Ã©crit par conflict</span
        >


      
        <span class="post-read-time"
          >â€” 3 minute(s) de lecture</span
        >
      
    </div>

    

    

    <div class="post-content">
      
      <h1 id="shoppyhtb">
  shoppy.htb
  <a href="#shoppyhtb" class="h-anchor" aria-hidden="true">#</a>
</h1>
<ul>
<li>Difficulty: Easy</li>
<li>OS: Linux</li>
<li>Link: <a href="https://app.hackthebox.com/machines/Shoppy">https://app.hackthebox.com/machines/Shoppy</a></li>
</ul>
<h1 id="note">
  Note
  <a href="#note" class="h-anchor" aria-hidden="true">#</a>
</h1>
<p>Il s&rsquo;agit d&rsquo;un des premiers write-ups que j&rsquo;ai Ã©crit de ma vie, j&rsquo;ai attendu que la machine retire avant de le poster. C&rsquo;est aussi possible que je n&rsquo;utilise pas les bons termes Ã  certains endroit, je n&rsquo;ai pas relu tout le write-up pour me corriger (j&rsquo;ai bien trop la flemme).</p>
<p>Vous allez aussi pouvoir voir Ã  quoi ressemblait mon m<em>A</em>g<code>n</code>i<strong>F</strong><em>i</em>Qu<strong>E</strong> Ubuntu Ã  cette Ã©poque (pas si lointaine)</p>
<h1 id="recon">
  Recon
  <a href="#recon" class="h-anchor" aria-hidden="true">#</a>
</h1>
<p>On arrive sur une page vide, avec un timer de 349 jours, et un message &ldquo;<em>Shoppy beta coming soon ! Stay tuned for beta access !</em>&rdquo;</p>
<p>Il s&rsquo;agit donc d&rsquo;une application qui n&rsquo;est pas encore dÃ©ployÃ©e, on peut s&rsquo;attendre Ã  un docker ou quelque chose du type</p>
<p><img src="https://i.ibb.co/qJVWWzd/image.png" alt="page.png"></p>
<p>On lance un dirbuster pour essayer de trouver des directories sur le site, et un wfuzz pour les sous domaines</p>
<p>Le dirbuster nous donne <code>http://shoppy.htb/admin</code> et <code>http://shoppy.htb/login</code></p>
<p>Le wfuzz nous donne <code>http://mattermost.shoppy.htb</code></p>
<p><img src="https://i.ibb.co/JtgYkcL/image.png" alt="dirbwfuzz.png"></p>
<h1 id="foothold">
  Foothold
  <a href="#foothold" class="h-anchor" aria-hidden="true">#</a>
</h1>
<p>Je commence par aller voir le <strong>/login</strong>, c&rsquo;est un form de connection classique avec un input et un username</p>
<p>Je tente une injection SQL: <code>username=admin' or1=1--</code> et <code>password=admin</code></p>
<p>La requÃªte prend beaucoup de temps, puis le serveur me renvoie un gateway timeout, ce qui arrive gÃ©nÃ©ralement quand on tente une injection SQL sur une database NoSQL, comme MongoDB</p>
<p>Je tente cette fois une injection NoSQL: <code>username=admin'||'1==1</code> &amp; <code>password=admin</code></p>
<p>Et&hellip;.. Je suis connectÃ© en tant qu&rsquo;admin</p>
<p><img src="https://i.ibb.co/ySNrqtN/image.png" alt="admin.png"></p>
<p>Je suis redirigÃ© sur le <strong>/admin</strong>, qui est&hellip; vide</p>
<p>Il y a quand mÃªme un bouton <em>Search for users</em>, qui redirige vers <code>/admin/search-users</code></p>
<p><img src="https://i.ibb.co/KKxp5Dc/image.png" alt="panel.png"></p>
<p>On a juste un input, en partant du principe que c&rsquo;est le mÃªme backend qui gÃ¨re Ã§a aussi, j&rsquo;entre la mÃªme injection NoSQL que pour le login, qui renverra <code>True</code>, soit <strong>tout les utilisateurs</strong>
J&rsquo;entre donc <code>a'||'1==1</code> dans l&rsquo;input, et j&rsquo;appuie sur le bouton Download export qui apparaÃ®t</p>
<p><img src="https://i.ibb.co/c3qhSFn/image.png" alt="search.png"></p>
<p>On voit <strong>deux utilisateurs</strong>: <code>admin</code> et <code>josh</code></p>
<p>On a aussi les deux hash de leurs mot de passe, en md5</p>
<p><img src="https://i.ibb.co/vQmY4PT/image.png" alt="export.png"></p>
<p>Qui dit hash, dit hashcat, on prend le hash de josh, et on lance hashcat  avec le hash <code>6ebcea65320589ca4f2f1ce039975995</code> et rockyou en wordlist</p>
<p><img src="https://i.ibb.co/FDXvRGf/image.png" alt="hashcat.png"></p>
<p>On a maintenant le mot de passe de josh</p>
<blockquote>
<p>Note: Je suis allÃ© me connecter au /admin avec ses logins, Ã§a a fonctionnÃ© mais il avait le mÃªme panel que l&rsquo;utilisateur admin</p>
</blockquote>
<p>Je vais sur le mattermost pour me connecter avec le compte de <strong>josh</strong></p>
<p><img src="https://i.ibb.co/2WRgD8Q/image.png" alt="mattermost.png"></p>
<p>En se balandant un peu sur le mattermost, on trouve un channel privÃ© &ldquo;deploy machine&rdquo;, dans lequel on trouve des identifiants, probabelement pour se connecter au ssh de la machine</p>
<p><img src="https://i.ibb.co/qxJn844/image.png" alt="ssh.png"></p>
<h1 id="lateral-move-jaeger---deploy">
  Lateral Move (jaeger -&gt; deploy)
  <a href="#lateral-move-jaeger---deploy" class="h-anchor" aria-hidden="true">#</a>
</h1>
<p><code>ssh jaeger@10.10.11.180</code></p>
<p>On est connectÃ©s au SSH, on <code>cat user.txt</code> pour flag le user</p>
<p><img src="https://i.ibb.co/MgZ5hHH/image.png" alt="user.png"></p>
<p>On fait un <code>sudo -l</code> pour voir si on a des accÃ¨s particuliers</p>
<p><img src="https://i.ibb.co/j47VCt5/image.png" alt="sudol.png"></p>
<p>On voit qu&rsquo;on peut Ã©xÃ©cuter password-manager en tant que deploy sur la machine, on va d&rsquo;abord aller voir ce qu&rsquo;il y a dans ce dernier</p>
<p><code>cat /home/deploy/password-manager</code></p>
<p><img src="https://i.ibb.co/F3kZKzF/image.png" alt="password.png"></p>
<p>C&rsquo;est trÃ¨s peu lisible puisqu&rsquo;il s&rsquo;agit d&rsquo;un ELF mais on voit, sur la ligne au milieu du screen, que si on entre <strong>Sample</strong> quand il demande le password, il nous autorise l&rsquo;accÃ¨s</p>
<p>On va donc lancer password-manager en tant que deploy puis entrer le mot de passe</p>
<p><code>sudo -u deploy /home/deploy/password-manager</code></p>
<p><img src="https://i.ibb.co/DkK0WfM/image.png" alt="deploy.png"></p>
<p>On a les identifiants de l&rsquo;user deploy, on va s&rsquo;y connecter</p>
<h1 id="privilege-escalation-via-docker-escape">
  Privilege Escalation (via Docker Escape)
  <a href="#privilege-escalation-via-docker-escape" class="h-anchor" aria-hidden="true">#</a>
</h1>
<p>Une fois connectÃ©, on voit, en faisant <code>id</code> que deploy est dans le groupe <strong>docker</strong></p>
<p><img src="https://i.ibb.co/xYBk7x5/image.png" alt="docker.png"></p>
<p>On va donc partir sur une docker escape, qu&rsquo;on rÃ©cupÃ¨re sur GTFObins:</p>
<p><code>docker run -v /:/mnt --rm -it alpine chroot /mnt sh</code></p>
<p><img src="https://i.ibb.co/hCQpDDz/image.png" alt="root.png"></p>
<p>Et voilÃ  ! On est maintenant root et on peut rÃ©cupÃ©rer le flag.</p>

    </div>
    
      
        <div class="pagination">
          <div class="pagination__title">
            <span class="pagination__title-h"
              >voir d&#39;autres posts</span
            >
            <hr />
          </div>
          <div class="pagination__buttons">
            
            
              <span class="button next">
                <a href="/post/ropemporium-split-x64/">
                  <span class="button__text">ðŸ‡«ðŸ‡· ROPEmporium - split (x64)</span>
                  <span class="button__icon">â†’</span>
                </a>
              </span>
            
          </div>
        </div>
      
    

    
      
        

      
    
  </article>

      </div>

      
        <footer class="footer">
  <div class="footer__inner">
    
      <div class="copyright copyright--user">rami malek en personne</div>
      
  </div>
</footer>





<script type="text/javascript" src="/bundle.min.js"></script>


      
    </div>

    
  </body>
</html>
